@namespace ExtraDry.Blazor
@implements IExtraDryComponent
@typeparam TItem

<div class="@CssClasses" id="@Id" @attributes="@UnmatchedAttributes"
     @onfocusin="DoFocusIn" @onfocusout="DoFocusOut" 
     @onkeydown:preventDefault="PreventDefault" @onkeypress:preventDefault="PreventDefault" @onkeyup:preventDefault="PreventDefault"
     @onkeydown="DoKeyPress" tabindex="-1">
    <label>
        @if(Icon != null) {
            <Icon Key="@Icon" />
        }
        <span class="type"></span>
        <input type="text" name="@Name" placeholder="@Placeholder" value="@Filter" @oninput="DoFilterInput" />
        @if(ShowProgress) {
            <progress></progress>
        }
        <button class="unobtrusive" @onclick="DoButtonClick" type="button" tabindex="-1"><Icon Key="select" /></button>
    </label>
    @if(ShowOptions) {
        <ol class="options" id="@OptionsId">
            @{
                int index = 0;
                var lastGroup = string.Empty;
                foreach(var item in FilteredItems) {
                    if(item == null) { 
                        continue;  
                    }
                    var selected = item.Equals(SelectedItem) ? "selected" : "";
                    int i = index;
                    var group = DisplayItemGroup(item);
                    if(ShowGrouping && !lastGroup.Equals(group, StringComparison.CurrentCultureIgnoreCase)) {
                        var id = index == 0 ? DisplayFirstHeaderId : "";
                        <li id="@id" class="header">@group</li>
                        lastGroup = group;
                    }
                    <li id="@DisplayItemID(item)" class="option @selected" @onclick="async e => await DoItemClick(item)">@DisplayItemTitle(item)</li>
                    ++index;
                }
                if(MoreCount > 0) {
                    <li id="@DisplayMoreCaptionId" class="more">@DisplayMoreCaption</li>
                }
            }
        </ol>
    }
</div>
