@namespace ExtraDry.Blazor
@using ExtraDry.Blazor.Internal
@typeparam T

@if (Model == null)
{
    <progress>Loading...</progress>
}
else
{
    <CascadingValue Value="@EditMode">
        <CascadingValue Value="@this">
            <form class="@ModelNameSlug" onsubmit="return false;" action="/" method="GET">
                <div class="@ModelNameSlug entity-info">
                    <DryIcon Key="@Description.Icon" />
                    <label>@Description.ModelDisplayName</label>
                </div>
                <div class="@ModelNameSlug status-properties">
                    @foreach (var fieldset in FormDescription.Fieldsets.Take(FixedGroups)) {
                        <CascadingValue Value="@fieldset">
                            <DryFormFieldset T="@T" />
                        </CascadingValue>
                    }
                </div>
                <div class="@ModelNameSlug description-properties">
                    @foreach(var fieldset in FormDescription.Fieldsets.Skip(FixedGroups)) {
                        <CascadingValue Value="@fieldset">
                            <DryFormFieldset T="@T" />
                        </CascadingValue>
                    }
                    <div class="content">
                        @ChildContent
                    </div>
                    @if(error != null) {
                        <div class="alert danger">
                            <h5><i></i> Error</h5>
                            @error
                        </div>
                    }
                    <div class="line">
                        <div class="field">
                            <DryButtonBar Commands="@Description.Commands" Target="@Model" />
                        </div>
                    </div>
                </div>
            </form>
        </CascadingValue>
    </CascadingValue>
}
